<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>cms管理系统</title>
    <link rel="stylesheet" href="/js/lib/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/styles.css" />
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/ajaxfileupload.js"></script>
    <script type="text/javascript" src="/js/md5.js"></script>
    <script type="text/javascript" src="/js/lib/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/lib/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="/js/lib/ueditor/ueditor.all.js"></script>
    <script type="text/javascript" src="/js/cmsHttp.js"></script>
</head>

<body>
    <div class="header">
        <h1>cms管理系统</h1>
        <a href="/login.html" class="logout">登出</a>
    </div>
    <div class="leftWrapper">
        <ul>
            % if groups == 1000:
            <li>
                <h3>管理员设置</h3>
                <ul>
                    <li><a href="/admin.html" class="adminMenu">管理员设置</a></li>
                </ul>
            </li>
            % endif
            <li>
                <h3>新闻公告</h3>
                <ul>
                    <li><a href="/newslist.html?newsId=1" class="newsMenu">普通新闻</a></li>
                    <li><a href="/newslist.html?newsId=2" class="newsMenu">概要新闻</a></li>
                    <li><a href="/newslist.html?newsId=3" class="newsMenu">即时新闻</a></li>
                    <li><a href="/newslist.html?newsId=4" class="newsMenu">招聘信息</a></li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="rightWrapper">
        <div class="bread"><button type="button" class="btn btn-link returnback">返回</button>>>添加<span></span></div>
        <div class="list">
            <div class="fontab">
                <div class="form-group"><label>标题：</label><input type="text" class="form-control title" /></div>
                <div class="form-group"><label>副标题：</label><input type="text" class="form-control subtitle" /></div>
                <div class="form-group"><label>新闻类型：</label><select class="form-control section"><option value="1">Unknown</option></select></div>
                <div class="form-group"><label>新闻类别：</label><select class="form-control gmtype"><option value="1">标识资讯</option><option value="2">通告资讯</option><option value="3">技术资讯</option></select></div>
                <div class="form-group">
                    <label>图片：</label>
                    <div style="overflow: hidden; position: relative; line-height: 34px;">
                        <input type="file" id="uploadImg" name="uploadImg" />
                        <button type="button" class="btn btn-default" id="upload">上传图片</button>
                        <span id="imgUrl" style="margin-left: 10px;"> </span>
                        <img id="loading" src="js/lib/ueditor/themes/default/images/loading.gif" style="margin-left: 10px; display: none;" />
                        <input type="hidden" id="imgVal" />
                    </div>
                    <div style="margin-top: 10px;">图片预览：<img id="preview" src="images/nopic.png" /></div>
                </div>
                <div class="form-group"><label>内容：</label><script id="content" type="text/plain" style="height:300px;"></script></div>
                <div class="form-group"><button type="button" class="btn btn-success sub">确 定</button></div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    $(function(){

        //面包屑
        var newsId = getParam('newsId');
        var v = $('.newsMenu').eq(newsId-1).text();
        $('.bread span').text(v);

        //新增新闻
        $('.sub').click(function(){
            var title = $('.title').val();
            var subtitle = $('.subtitle').val();
            var author = $('.author').val();
            var section = $('.section').val();
            var gmtype = $('.gmtype').val();
            var content = ue.getContent();
            var mask = 1<<newsId;
            var image = $('#imgVal').val();

            var $this = $(this);

            var objMessage = {
                manager: cmsManager,
                token: cmsToken,
                title: title,
                subtitle: subtitle,
                section: section,
                gmtype: gmtype,
                content: content,
                mask: mask,
                image: image
            };

            $.ajax({
                url: cmsUrl+'message',
                data: objMessage,
                type: "post",
                dataType: "json",
                beforeSend: function () {
                    $this.attr({ disabled: "disabled" });
                },
                success: function(data){
                    console.log(data);
                    window.location.href = '/newslist.html?newsId='+newsId+'&manager='+cmsManager+'&token='+cmsToken;
                    alert('添加成功');
                },
                complete: function () {
                    $this.removeAttr("disabled");
                },
                error: function(data){
                    alert('添加失败');
                }
            });
        });

        //编辑器初始化
        var ue = UE.getEditor('content');
        ue.ready(function(){});
    });
</script>
</html>